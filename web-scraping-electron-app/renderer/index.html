<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline'">
    <title>J-Initiative Web Scraper</title>
    <link rel='stylesheet' type='text/css' media='screen' href='../renderer/css/style.css'>
    <link rel='stylesheet' type='text/css' media='screen' href='../node_modules/bootstrap/dist/css/bootstrap.css'>
    <script src='../node_modules/jquery/dist/jquery.js'></script>
    <script type="module" src="../js_to_py_comms.js">
    </script>
    <script>
        // Psuedo-enum object used for organization and control of page state
        const Pages = {
            Home: {
                name: "home",
                state: null
            },
            Scrape: {
                name: "scrape",
                state: null
            },
            About: {
                name: "about",
                state: null
            }
        };

        // Tracks the current page
        var currentPage;

        /**
         * Initializes all of the pages using the pre-defined components.
         */
        function initPages() {
            $.get("components/home.html", function(data) {
                Pages.Home.state = data;
            });
            $.get("components/scrape.html", function(data) {
                Pages.Scrape.state = data;
            });
            $.get("components/about.html", function(data) {
                Pages.About.state = data;
            });

            currentPage = getPage("home");
        }

        /**
         * Updates the current state of the current page (effectively just stores the current state of the given element).
         */
        function updatePageState() { 
            currentPage.state = document.getElementById("d_content").children[0]; 
        }

        /**
         * Returns the corresponding Page 'enum' object (has name and state).
         */
        function getPage(value) {
            var result;

            Object.keys(Pages).forEach(e => {
                if (Pages[e].name === value) {
                    result = Pages[e];
                }
            });

            return result;
        }

        /**
         * Method for dynamically changing the page. This is accomplished through the use of predefined components, and using JQuery to insert the 
         * html for these components into the page.
         */
        function changePage(element) {
            var pageName = element.id.split('-')[0];
            var newPage = getPage(pageName);

            if (currentPage.name !== newPage.name) {
                updatePageState();
                $('#d_content').html(newPage.state);
                currentPage = newPage;
                console.log("Page Changed To " + pageName);
            } else {
                console.log("Page Not Changed");
            }
        }

        /**
         * Method for exitting the application.
         */
        function exitApp() {
            const remote = require('electron').remote;
            let currWin = remote.getCurrentWindow();
            currWin.close();
        }

        initPages();
    </script>
</head>
<body>
    <nav class="navbar navbar-expand-sm bg-body-tertiary .navbar-dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">Web Scraper</span>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-0">
                    <li class="nav-item">
                        <a class="nav-link" id="home-nav" aria-current="page" onclick="changePage(this)" href="#">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="scrape-nav" aria-current="page" onclick="changePage(this)" href="#">Scraper</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="about-nav" onclick="changePage(this)" href="#">About</a>
                    </li>
                </ul>
                <ul class="navbar-nav ms-auto mb-0">
                    <li class="nav-item">
                        <a class="nav-link" id="exit-nav" aria-current="page" onclick="window.close()" href="#">Exit</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div id="d_content" class="container-fluid">
        <script>
            $('#d_content').load('components/home.html');
        </script>
    </div>
    <script src='../node_modules/bootstrap/dist/js/bootstrap.bundle.js'></script>
</body>
</html>