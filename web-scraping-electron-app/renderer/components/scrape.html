<!-- HTML component used for the web scraping form in the application. -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Web Scraper Form</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
</head>
<body>
<div id="scrape-container" class="my-5 container">
    <h1 class="display-4">Web Scraper Form</h1>

    <!-- Scraper Form -->
    <div id="scrape-form-container" class="my-4">
        <form id="scrape-form">
            <div class="mb-3">
                <label for="url-input" class="form-label">URL of Web Page</label>
                <div class="input-group mb-3">
                    <input
                      id="url-input"
                      type="text"
                      class="form-control"
                      placeholder="Enter the URL here"
                      aria-label="URL"
                      aria-describedby="submit-button"
                      required
                    />
                    <button
                      class="btn btn-outline-secondary"
                      type="submit"
                      id="submit-button"
                    >
                        Submit
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Results Container -->
    <div id="results-container" class="accordion mt-5" style="display: none;">
        <div class="mb-3 row">
            <label for="staticURL" class="col-sm-2 col-form-label">URL</label>
            <div class="col-sm-10">
                <input
                  type="text"
                  readonly
                  class="form-control-plaintext"
                  id="staticURL"
                  value=""
                />
            </div>
        </div>

        <!-- Formatted Data Accordion -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingFormatted">
                <button
                  class="accordion-button collapsed"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#collapseFormatted"
                  aria-expanded="false"
                  aria-controls="collapseFormatted"
                >
                    Formatted Data
                </button>
            </h2>
            <div
              id="collapseFormatted"
              class="accordion-collapse collapse"
              aria-labelledby="headingFormatted"
              data-bs-parent="#results-container"
            >
                <div class="accordion-body" id="formatted-data-text">
                    <!-- Formatted data will be injected here -->
                </div>
            </div>
        </div>

        <!-- Raw Data Accordion -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingRaw">
                <button
                  class="accordion-button collapsed"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#collapseRaw"
                  aria-expanded="false"
                  aria-controls="collapseRaw"
                >
                    Raw Data
                </button>
            </h2>
            <div
              id="collapseRaw"
              class="accordion-collapse collapse"
              aria-labelledby="headingRaw"
              data-bs-parent="#results-container"
            >
                <div class="accordion-body" id="raw-data-text">
                    <!-- Raw data will be injected here -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS and dependencies (e.g., Popper) -->
<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
></script>

<script>
document.getElementById('scrape-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const urlInput = document.getElementById('url-input');
    const urlToScrape = urlInput.value.trim();

    if (!urlToScrape) {
        alert('Please enter a URL.');
        return;
    }

    // Disable the submit button to prevent multiple submissions
    const submitButton = document.getElementById('submit-button');
    submitButton.disabled = true;

    try {
        const response = await fetch('http://127.0.0.1:7777/url', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ url: urlToScrape })
        });

        const data = await response.json();

        if (response.ok && data.ok) {
            // Display the results
            document.getElementById('staticURL').value = data.url;
            document.getElementById('formatted-data-text').innerText = data.formattedData;
            document.getElementById('raw-data-text').innerText = data.rawData;
            document.getElementById('results-container').style.display = 'block';

            // Optionally, expand the accordions
            const formattedCollapse = new bootstrap.Collapse('#collapseFormatted', { toggle: false });
            const rawCollapse = new bootstrap.Collapse('#collapseRaw', { toggle: false });
            formattedCollapse.show();
            rawCollapse.show();
        } else {
            // Handle errors from the backend
            alert(`Error: ${data.detail || data.message || 'Unknown error occurred.'}`);
        }
    } catch (error) {
        console.error('Network Error:', error);
        alert('A network error occurred. Please try again later.');
    } finally {
        // Re-enable the submit button
        submitButton.disabled = false;
    }
});
</script>
</body>
</html>


