<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: backend/utils/sanitizer.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: backend/utils/sanitizer.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Expected usage: create a Sanitizer object with your input stored in it,
 * along with a SanitizeProtocol object that describes how to transform the text to sanitize it.
 * 
 * How to use:
 * var sanitizer = new Sanitizer([text], new SanitizeProtocol([regex string], {[character]: [replacement], [character]: [replacement]}), {[expression]: [replacement], [expression]: [replacement],...});
 * return sanitizer.sanitize();
 * 
 * ex.
 * var s = new Sanitizer('&lt;li class="%toggle %"\'ESCAPE^>', new SanitizeProtocol(), {"ESCAPE": "escape", "toggle": "TOGGLE"});
 * 
 * If you just want the presets already built in, call [sanitizerObject].htmlMode() or [sanitizerObject].sqlMode().
 * */
class Sanitizer {
	constructor(input, sanitizeProtocol, expressionMap = {}) {
		// If any structures need initializing, do that here
		this.input = input;
		if (sanitizeProtocol == null) {
			sanitizeProtocol = new sanitizeProtocol();
		}
		this.sanitizeProtocol = sanitizeProtocol;
		this.expressionMap = expressionMap;
	}

	getInput() {
		return this.input;
	}

	setInput(input) {
		this.input = input;
	}

	getProtocol() {
		return this.sanitizeProtocol;
	}

	setProtocol(sanitizeProtocol) {
		this.sanitizeProtocol = sanitizeProtocol;
	}

	getExpressionMap() {
		return this.expressionMap;
	}

	setExpressionMap(expressionMap) {
		this.expressionMap = expressionMap;
	}

	addToExpressionMap(key, value) {
		this.expressionMap[key] = value;
	}

	/**
	 * Settings to strip &amp;, &lt;, >, ", ', “, ”, ‘, ’
	 * Replaces each of the characters with their HTML hexcodes.
	 * */
	htmlMode() {
		this.sanitizeProtocol = new SanitizeProtocol("[&amp;&lt;>\"'/“”‘’]", 
			{
		      '&amp;': '&amp;amp;',
		      '&lt;': '&amp;lt;',
		      '>': '&amp;gt;',
		      '"': '&amp;quot;',
		      "'": '&amp;#x27;',
		      "/": '&amp;#x2F;',
		      "“": '&amp;quot;',
		      "”": '&amp;quot;',
		      "‘": '&amp;#x27;',
		      "’": '&amp;#x27;',
			});
		this.expressionMap = {};
	}

	/**
	 * Settings to strip %, _, ^, ESCAPE, ', [, ], /
	 * Replaces ^ with the HTML hexcode for ↑, _ with -, [] with (), ESCAPE with escape
	 * */
	sqlMode() {
		const sqlMap = {
	      '%': '&amp;#x25;',
	      '_': '-',
	      '^': '&amp;#x2191;',
	      "'": '&amp;#x27;',
	      "/": '&amp;#x2F;',
	      "[": '(',
	      "]": ')',
		};
		this.sanitizeProtocol = new SanitizeProtocol("[%_^\'\/\\[\\]]", sqlMap);
		this.expressionMap = {'ESCAPE': 'escape'};
	}

	/**
	 * Sanitizes the data following the rules established by the sanitizer's creation.
	 * @param input 		The text to sanitize. If none is given, the object will use whatever text was input via the constructor initially.
	 * @return String 		The sanitized text.
	 */
	sanitize(input = "") {
		if(input == "") {
			input = this.input;
		}
		var regexTransformed = this.sanitizeProtocol.sanitize(input);
		/*
		// Unused, as the expressionMap is now an object literal, not a Map object.
		const iterator = this.expressionMap.keys();
		for(var i = 0; i &lt; this.expressionMap.size; ++i) {
			var key = iterator.next().value;

			regexTransformed = regexTransformed.replaceAll(key,this.expressionMap.get(key));
		}*/

		for(var key in this.expressionMap) {
			regexTransformed = regexTransformed.replaceAll(key, this.expressionMap[key]);
		}

		return regexTransformed;
	}

	/**
	 * Removes HTML tags from the input text. Can also sanitize the data.
	 * @param input 		The text to sanitize. If none is given, the object will use whatever text was input via the constructor initially.
	 * @param alsoSanitize	Whether to also run the sanitize() method on the output. Defaults to true.
	 * @return String 		The sanitized text.
	 */
	removeTags(input = "", alsoSanitize = true) {
		if(input == "") {
			input = this.input;
		}

		var min = 0;
		var transformedInput = "";
		var substringInput = input;

		var keepGoing = true;
		while(keepGoing) {
			if(substringInput.indexOf('&lt;') &lt; min) {
				keepGoing = false;
			}
			else {
				// Check for whether the &lt; is part of a tag.
				// HTML tags cannot have a space after the opening &lt;, 
				// so the current test is to check for a space after the &lt;, 
				// and whether there's a closing > after the &lt;. 
				if(substringInput.charAt(substringInput.indexOf('&lt;') + 1) === " ") {
					
					transformedInput += substringInput.slice(min, substringInput.indexOf('&lt;') + 1);
					substringInput = substringInput.slice(substringInput.indexOf('&lt;') + 1);
				}
				else if(substringInput.indexOf('>') >= min) {
					var start = substringInput.indexOf('&lt;');
					var end = substringInput.indexOf('>') + 1;
					
					transformedInput += substringInput.slice(min, start);
					substringInput = substringInput.slice(end);
				}
				else {
					keepGoing = false;
				}
				
			}
		}
		if(alsoSanitize) {
			var regexTransformed = this.sanitizeProtocol.sanitize(input);

			for(var key in this.expressionMap) {
				regexTransformed = regexTransformed.replaceAll(key, this.expressionMap[key]);
			}

			return regexTransformed;		
		}
		else {
			return transformedInput;
		}
		
	}
}


// Note: this is a second class. I would normally move this to another file, but since it's only used as part of this script, it simplifies the imports needed.
class SanitizeProtocol {

	constructor(regexString = "", sanitizationMapping = {}) {
		this.regexString = regexString;
		this.sanitizationMapping = sanitizationMapping;

	}

	sanitize(textToSanitize) {
		const reg = new RegExp(this.regexString, "ig");
		return textToSanitize.replace(reg, (match)=>(this.sanitizationMapping[match]));
	}
}



//const t = new Sanitizer('&lt;li class="%toggle %"\'ESCAPE^>', new SanitizeProtocol(), new Map([["ESCAPE", "escape"], ["toggle", "TOGGLE"]]));

//t.addToMap("ESCAPE", "escape");
/*
const t = new Sanitizer('&lt;script src="../node_modules/bootstrap/dist/js/bootstrap.bundle.js">Test >&lt;>text&lt;/script>', new SanitizeProtocol(), {"ESCAPE": "escape", "toggle": "TOGGLE"});
t.htmlMode();

t.addToExpressionMap("script", "REPLACED");
console.log(t.removeTags("", false));
*/
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Sanitizer.html">Sanitizer</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addDataToDatabase">addDataToDatabase</a></li><li><a href="global.html#appendNewScrapedItem">appendNewScrapedItem</a></li><li><a href="global.html#axios">axios</a></li><li><a href="global.html#checkAncestorSelected">checkAncestorSelected</a></li><li><a href="global.html#checkIfAnyActive">checkIfAnyActive</a></li><li><a href="global.html#clearLinkedLSProject">clearLinkedLSProject</a></li><li><a href="global.html#clearLogUpdateInterval">clearLogUpdateInterval</a></li><li><a href="global.html#clearScrapedList">clearScrapedList</a></li><li><a href="global.html#clearTextSelection">clearTextSelection</a></li><li><a href="global.html#closeAllWindows">closeAllWindows</a></li><li><a href="global.html#closeLSWindow">closeLSWindow</a></li><li><a href="global.html#closeScrapeWindow">closeScrapeWindow</a></li><li><a href="global.html#combineSelToResObj">combineSelToResObj</a></li><li><a href="global.html#createLSExternal">createLSExternal</a></li><li><a href="global.html#createMainWindow">createMainWindow</a></li><li><a href="global.html#createURLWindow">createURLWindow</a></li><li><a href="global.html#deselectAllElements">deselectAllElements</a></li><li><a href="global.html#deselectElement">deselectElement</a></li><li><a href="global.html#disableAutoImportBtns">disableAutoImportBtns</a></li><li><a href="global.html#disableManImportBtn">disableManImportBtn</a></li><li><a href="global.html#disableModeSelector">disableModeSelector</a></li><li><a href="global.html#disableWebview">disableWebview</a></li><li><a href="global.html#enableAutoImportBtns">enableAutoImportBtns</a></li><li><a href="global.html#enableManImportBtn">enableManImportBtn</a></li><li><a href="global.html#enableModeSelector">enableModeSelector</a></li><li><a href="global.html#enableWebview">enableWebview</a></li><li><a href="global.html#exportDataToApp">exportDataToApp</a></li><li><a href="global.html#exportDataToLS">exportDataToLS</a></li><li><a href="global.html#formIndivDataResObj">formIndivDataResObj</a></li><li><a href="global.html#formLogObject">formLogObject</a></li><li><a href="global.html#formatDataArr">formatDataArr</a></li><li><a href="global.html#formatProjectData">formatProjectData</a></li><li><a href="global.html#formatTextData">formatTextData</a></li><li><a href="global.html#getAllReadyData">getAllReadyData</a></li><li><a href="global.html#getProjects">getProjects</a></li><li><a href="global.html#getSelectedText">getSelectedText</a></li><li><a href="global.html#hotKeySettingChanging">hotKeySettingChanging</a></li><li><a href="global.html#hotKeySettingNormal">hotKeySettingNormal</a></li><li><a href="global.html#hotkeyChangeRequested">hotkeyChangeRequested</a></li><li><a href="global.html#hoveredElement">hoveredElement</a></li><li><a href="global.html#indivSelToResObj">indivSelToResObj</a></li><li><a href="global.html#initDataContainer">initDataContainer</a></li><li><a href="global.html#initKeyMouseEventListeners">initKeyMouseEventListeners</a></li><li><a href="global.html#initLogListener">initLogListener</a></li><li><a href="global.html#initScrapeUtilListeners">initScrapeUtilListeners</a></li><li><a href="global.html#initScrapeWindow">initScrapeWindow</a></li><li><a href="global.html#initTheme">initTheme</a></li><li><a href="global.html#initWinListeners">initWinListeners</a></li><li><a href="global.html#logDebug">logDebug</a></li><li><a href="global.html#logError">logError</a></li><li><a href="global.html#logInfo">logInfo</a></li><li><a href="global.html#logWarn">logWarn</a></li><li><a href="global.html#makeLog">makeLog</a></li><li><a href="global.html#makeRequestToLS">makeRequestToLS</a></li><li><a href="global.html#manualTextScrape">manualTextScrape</a></li><li><a href="global.html#processSelectedElems">processSelectedElems</a></li><li><a href="global.html#releaseHoveredElement">releaseHoveredElement</a></li><li><a href="global.html#removeSelectedItems">removeSelectedItems</a></li><li><a href="global.html#requestHeader">requestHeader</a></li><li><a href="global.html#requestJSON">requestJSON</a></li><li><a href="global.html#selectElement">selectElement</a></li><li><a href="global.html#selectedElementsCheck">selectedElementsCheck</a></li><li><a href="global.html#selectedTextCheck">selectedTextCheck</a></li><li><a href="global.html#sendNewLogsToRenderer">sendNewLogsToRenderer</a></li><li><a href="global.html#setHotKey">setHotKey</a></li><li><a href="global.html#startLoggingInterval">startLoggingInterval</a></li><li><a href="global.html#terminateApp">terminateApp</a></li><li><a href="global.html#terminateLogListener">terminateLogListener</a></li><li><a href="global.html#updateAPIToken">updateAPIToken</a></li><li><a href="global.html#updateLinkedLSProject">updateLinkedLSProject</a></li><li><a href="global.html#writeNewLog">writeNewLog</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sat Mar 22 2025 08:06:57 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
